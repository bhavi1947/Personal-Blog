<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Personal Blog</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    .article { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; }
    button { margin-right: 5px; }
    input, textarea { display: block; margin-bottom: 10px; width: 100%; padding: 5px; }
  </style>
</head>
<body>

<h1>Personal Blog</h1>

<div id="guest-section">
  <h2>Articles</h2>
  <div id="articles"></div>
</div>

<hr>

<div id="admin-section">
  <h2>Admin Dashboard</h2>
  <button onclick="showAddArticleForm()">Add New Article</button>
  <div id="admin-articles"></div>

  <div id="add-article-form" style="display:none;">
    <h3>Add / Edit Article</h3>
    <input type="hidden" id="article-id">
    <input type="text" id="title" placeholder="Title">
    <textarea id="content" placeholder="Content"></textarea>
    <input type="date" id="date">
    <button onclick="saveArticle()">Save Article</button>
    <button onclick="hideAddArticleForm()">Cancel</button>
  </div>
</div>

<script>
  const API_URL = "http://localhost:8080/api/articles";

  // Load articles for guest section
  function loadArticles() {
      fetch(API_URL)
      .then(res => res.json())
      .then(data => {
          const container = document.getElementById("articles");
          container.innerHTML = "";
          data.forEach(a => {
              const div = document.createElement("div");
              div.className = "article";
              div.innerHTML = `<h3>${a.title}</h3>
                               <p>${a.content}</p>
                               <small>${a.date}</small>`;
              container.appendChild(div);
          });
      });
  }

  // Load articles for admin section
  function loadAdminArticles() {
      fetch(API_URL)
      .then(res => res.json())
      .then(data => {
          const container = document.getElementById("admin-articles");
          container.innerHTML = "";
          data.forEach(a => {
              const div = document.createElement("div");
              div.className = "article";
              div.innerHTML = `<h3>${a.title}</h3>
                               <small>${a.date}</small><br>
                               <button onclick="editArticle(${a.id})">Edit</button>
                               <button onclick="deleteArticle(${a.id})">Delete</button>`;
              container.appendChild(div);
          });
      });
  }

  // Show add article form
  function showAddArticleForm() {
      document.getElementById("add-article-form").style.display = "block";
  }

  // Hide add article form
  function hideAddArticleForm() {
      document.getElementById("add-article-form").style.display = "none";
      document.getElementById("article-id").value = "";
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      document.getElementById("date").value = "";
  }

  // Save article (add or edit)
  function saveArticle() {
      const id = document.getElementById("article-id").value;
      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;
      const date = document.getElementById("date").value;

      const method = id ? "PUT" : "POST";
      const url = id ? `${API_URL}/${id}` : API_URL;

      fetch(url, {
          method: method,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title, content, date })
      }).then(() => {
          hideAddArticleForm();
          loadArticles();
          loadAdminArticles();
      });
  }

  // Edit article
  function editArticle(id) {
      fetch(`${API_URL}/${id}`)
      .then(res => res.json())
      .then(a => {
          document.getElementById("article-id").value = a.id;
          document.getElementById("title").value = a.title;
          document.getElementById("content").value = a.content;
          document.getElementById("date").value = a.date;
          showAddArticleForm();
      });
  }

  // Delete article
  function deleteArticle(id) {
      if(confirm("Are you sure to delete this article?")) {
          fetch(`${API_URL}/${id}`, { method: "DELETE" })
          .then(() => {
              loadArticles();
              loadAdminArticles();
          });
      }
  }

  // Initial load
  loadArticles();
  loadAdminArticles();
</script>

</body>
</html>
